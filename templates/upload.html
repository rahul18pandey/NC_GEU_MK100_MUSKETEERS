<html>

<head>
  <title>HTML dynamic table using JavaScript</title>
  <script type="text/javascript" src="app.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.3.1/css/all.min.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;0,900;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <html>

  <head>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <!--		for delete row-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="../static/css/materialize.min.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="../static/css/k-style.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="../static/fonts/beyond_the_mountains-webfont.css"
      media="screen,projection" />
  </head>
  <style>

  </style>

<body onload="load()">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-storage.js"></script>

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyBYyNRsISshMh9B2K7dA1vfrLSGDpEPV3M",
      authDomain: "sakshamkisan-a168b.firebaseapp.com",
      databaseURL: "https://sakshamkisan-a168b.firebaseio.com",
      projectId: "sakshamkisan-a168b",
      storageBucket: "sakshamkisan-a168b.appspot.com",
      messagingSenderId: "343160654067",
      appId: "1:343160654067:web:6aa94660d11f826476cf86",
      measurementId: "G-SZMLB65V63"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();


    var storage = firebase.storage();
    var db = firebase.firestore();
  //db.settings({timestampsInSnashots:true});



  </script>
  <div class="fixed-action-btn">
    <a class="btn-floating btn-large red">
      <i class="large material-icons">mode_edit</i>
    </a>
    <ul>
      <li><a class="btn-floating pulse blue"><i class="material-icons">chat</i></a></li>
      <li><a class="btn-floating yellow pulse darken-1"><i class="material-icons">notifications</i></a></li>
      <li><a class="btn-floating pulse green"><i class="material-icons">power_settings_new</i></a></li>

    </ul>
  </div>

  <nav style="background-color: limegreen;">
    <div class="nav-wrapper">
      <a href="/buyerhome" class="brand-logo mastfont" style="font-size: 50px; height: auto;">Saksham kisan</a>

      <ul class="right hide-on-med-and-down">
        <li><a href="/buyerbuy">Buy</a></li>
        <li><a href="/buyerauction">Auction</a></li>

        <li><a class="waves-effect waves-light btn" href="#">Language</a></li>
      </ul>
    </div>
  </nav>
  <ul class="hide-on-med-and-up">
    <ul id="slide-out" class="sidenav ">
      <li><a href="/buyerbuy">Buy</a></li>

      <li><a href="/buyerauction">Auction</a></li>

      <li><a class="waves-effect waves-light btn" href="#">Language</a></li>
    </ul>

    <a href="#" data-target="slide-out" class="sidenav-trigger"><i class="material-icons">menu</i></a>
  </ul>

  <h1 class="mastfont center-align" style="font-size: 120px;margin-top: 3%;">Upload Bills</h1>
  <div class="container">

    <center>

      <div id="myform">
        <!--<b>Simple form with name and age ...</b>-->
        <table>
          <tr>
            <td>
              <div class="input-field col s12 m6 l2">
                <i class="material-icons prefix">local_florist</i>
                <input id="crop" type="text" onkeyup="myFunction()" class="validate">
                <label for="crop">Crop type</label>
              </div>
            </td>
            <!--        <td><input type="text" id="name" style="width: 20%;"></td>-->

            <td>
              <div class="input-field col s12 m6 l2">
                <i class="material-icons prefix">work</i>
                <input id="quantity" type="tel" class="validate">
                <label for="quantity">Quantity</label>
              </div>
            </td>
            <!--
        <td><input type="text" id="age">
      </td>
-->
            <td><a class="waves-effect waves-light btn-small" onclick="addcrop()">Add</a></td>
          </tr>

        </table>

      </div>
      <!--						  <input type="button" id="add" value="Add" onclick="Javascript:addRow()" style="height:35px; width: 50px;">-->
      <div class="row">
        <div class="file-wrapper" style="margin-top: -15%;width: 50%;margin-left: -10%;">
          <div class="upload-btn-wrapper">
            <button class="btn upload-file font-weight-500">
              <span class="upload-btn">
                <i class="fas fa-cloud-upload-alt d-block font-50 pb-2"></i>
                Upload bills here
              </span>
              <span class="upload-select-button" id="blankFile">
                Supports JPG, JPG2000,PDF and PNG
              </span>
              <span class="success">
                <i class="far fa-check-circle text-success"></i>
              </span>
            </button>
            <input type="file" name="selectfile" id="selectfile">
          </div>
        </div>



        <div id="mydata">

          <table id="myTableData" border="1" cellpadding="2" style="width: 50%;margin-left: 40%;margin-top: -50%;">
            <tr>

              <td><b>Crop Type</b></td>
              <td><b>Quantity</b></td>
              <td><b>Link</b></td>


            </tr>
            <tbody id="details">

            </tbody>
          </table>
          &nbsp;

        </div>
      </div>
    </center>
  </div>


  <script type="text/javascript">

    // uploading data
    //function uploadfile()
    //{



    document.getElementById("selectfile").addEventListener('change', function (e) {
      var selectedFile = event.target.files[0];


      var filename = selectedFile.name;
      var storageRef = storage.ref('/imagenew/' + filename);
      var uploadtask = storageRef.put(selectedFile);


      // Register three observers:
      // 1. 'state_changed' observer, called any time the state changes
      // 2. Error observer, called on failure
      // 3. Completion observer, called on successful completion
      uploadtask.on('state_changed', function (snapshot) {
        // Observe state change events such as progress, pause, and resume
        // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        console.log('Upload is ' + progress + '% done');
        switch (snapshot.state) {
          case firebase.storage.TaskState.PAUSED: // or 'paused'
            console.log('Upload is paused');
            break;
          case firebase.storage.TaskState.RUNNING: // or 'running'
            console.log('Upload is running');
            break;
        }
      }, function (error) {
        // Handle unsuccessful uploads
      }, function () {
        // Handle successful uploads on complete
        // For instance, get the download URL: https://firebasestorage.googleapis.com/...
        uploadtask.snapshot.ref.getDownloadURL().then(function (downloadURL) {
          console.log('File available at', downloadURL);
          document.getElementById("fileURLcontainer").value = downloadURL;

        });
      });
    });


  </script>

  <input type="text" name="" id="userEmailcontainer" value="{{userid}}" style="display: none;">
  <input type="text" name="" id="fileURLcontainer" style="display: none;">


  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="js/main.js"></script>
  <script>
    $("#selectfile").bind('change', function () {
      var filename = $("#selectfile").val();
      if (/^s*$/.test(filename)) {
        $("#blankFile").text("No File Chosen..");
        $(".success").hide();
      } else {
        $("#blankFile").text(filename.replace("C:\\fakepath\\", ""));
        $(".success").show();
      }
    })






    function addcrop() {
      userEmail = document.getElementById("userEmailcontainer").value;
      userFile = document.getElementById("fileURLcontainer").value;
      cropType = document.getElementById("crop").value;
      cropQuantity = document.getElementById("quantity").value;
      // Add a new document in collection "cities"
      db.collection("Bill").doc().set({
        Email: userEmail,
        Bill_Quantity: "CA",
        Type: cropType,
        URL: userFile
      })
        .then(function () {
          console.log("Document successfully written!");
          document.getElementById("details").innerHTML=`
            <tr>
              <td>`+cropType+`</td>
              <td>`+cropQuantity+`</td>
              <td>`+userFile+`</td>
            </tr>
          `;
        })
        .catch(function (error) {
          console.error("Error writing document: ", error);
        });
    }




  </script>

  <!--	for adding the row in table by add button-->
  <!--
	<script>
		function addRow() {
          
    var myName = document.getElementById("crop");
    var quantity = document.getElementById("quantity");
    var link = document.getElementById("");
    var table = document.getElementById("myTableData");
 
    var rowCount = table.rows.length;
    var row = table.insertRow(rowCount);
// 
//    row.insertCell(0).innerHTML= '<input type="button" value = "Delete" onClick="Javacsript:deleteRow(this)">';
    row.insertCell(0).innerHTML= myName.value;
    row.insertCell(1).innerHTML= quantity.value;
    row.insertCell(2).innerHTML= link.value;
 
}
 
 
function load() {
    
    console.log("Page load finished");
 
}
	</script>
-->

</body>

</html>